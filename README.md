# Бот для анализа КБЖУ по фотографии еды

Телеграм-бот, который анализирует пищевую ценность блюд по фотографии и рассчитывает КБЖУ (калории, белки, жиры, углеводы). 
Проект включает в себя распознавание еды с помощью CHATGPT, расчет пищевой ценности и систему подписок с ЮKassa.

## Основные функции

- Анализ фотографий еды и распознавание продуктов
- Расчет калорий, белков, жиров и углеводов
- Бесплатный лимит запросов для новых пользователей
- Система платных подписок через ЮKassa
- Статистика использования для каждого пользователя

## Требования

- Python 3.8+
- Telegram Bot API токен
- Google Cloud Vision API ключ
- Аккаунт ЮKassa для приема платежей
- Доступ к серверу с SSL (для продакшена)

## Установка и настройка

1. Клонировать репозиторий:
```
git clone https://github.com/your-username/nutrition-bot.git
cd nutrition-bot
```

2. Создать виртуальное окружение и установить зависимости:
```
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
pip install -r requirements.txt
```

3. Создать `.env` файл на основе `.env.example` и заполнить его своими данными:
```
cp .env.example .env
# Отредактировать .env файл с вашими настройками
```

4. Создать бота в Telegram через [@BotFather](https://t.me/BotFather) и получить API-токен
5. Настроить Google Cloud Vision API:
   - Создать проект в [Google Cloud Console](https://console.cloud.google.com/)
   - Включить Vision API
   - Создать ключ сервисного аккаунта и скачать JSON-файл
6. Настроить аккаунт в [ЮKassa](https://yookassa.ru/):
   - Зарегистрировать магазин
   - Получить идентификатор магазина и секретный ключ

## Запуск для разработки (поллинг)

```
python bot.py
```

## Запуск в продакшене (веб-хук)

1. Настроить SSL-сертификаты (например, с [Let's Encrypt](https://letsencrypt.org/))
2. Настроить переменные окружения для веб-хука в файле `.env`
3. Запустить сервер:
```
python webhook_server.py
```

Для запуска в фоновом режиме можно использовать supervisor или systemd.

## Структура проекта

```
nutrition_bot/
├── .gitignore                 # Игнорируемые файлы для Git
├── README.md                  # Описание проекта (пустой файл)
├── bot.py                     # Основной файл бота с обработчиками команд
├── config.py                  # Конфигурационные параметры и переменные окружения
├── requirements.txt           # Зависимости проекта
├── database/                  # Модуль для работы с базой данных
│   ├── __init__.py
│   ├── db_manager.py          # Управление базой данных и запросами
│   └── models.py              # Модели базы данных (SQLAlchemy)
├── food_recognition/          # Модуль для распознавания еды
│   ├── __init__.py
│   ├── aitunnel_adapter.py    # Адаптер для AITunnel API
│   ├── aitunnel_vision_api.py # Взаимодействие с GPT-4o через AITunnel
│   ├── nutrition_calc.py      # Расчет пищевой ценности
│   └── vision_api.py          # Использование Google Cloud Vision API
├── payments/                  # Модуль для обработки платежей
│   ├── __init__.py
│   └── yukassa.py             # Интеграция с ЮKassa
└── utils/                     # Вспомогательные утилиты
    ├── __init__.py
    └── helpers.py             # Вспомогательные функции
```

## Дальнейшее развитие проекта

- Улучшение точности распознавания пищи с помощью дополнительных API
- Расширение базы данных пищевой ценности продуктов
- Добавление функции аналитики питания с графиками и рекомендациями
- Разработка административной панели
- Добавление мультиязычности

## Лицензия

[MIT License](LICENSE)

## Контакты

Если у вас возникли вопросы или предложения, свяжитесь со мной:
- Email: your-email@example.com
- Telegram: @your_telegram